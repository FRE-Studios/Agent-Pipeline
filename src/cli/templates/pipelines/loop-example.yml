# Loop Pipeline Example
# Demonstrates pipeline-level looping configuration
# Docs: https://github.com/FRE-Studios/agent-pipeline
#
# This pipeline auto-loops when run because looping.enabled: true
# No --loop CLI flag needed! The final stage agent receives instructions
# to create new pipeline files in the pending directory when needed.
#
# Loop directories are automatically created per session at:
#   .agent-pipeline/loops/{sessionId}/pending|running|finished|failed
#
# In worktree mode, directories are created in the worktree during execution
# and copied to the main repo after the loop session completes.
#
# Usage:
#   agent-pipeline run loop-example           # Auto-loops
#   agent-pipeline run loop-example --no-loop # Force single run

name: loop-example
trigger: manual

settings:
  autoCommit: false
  commitPrefix: "[loop:{{stage}}]"
  failureStrategy: continue
  executionMode: sequential
  handover:
    directory: pipeline-runs/loop-example

# Pipeline-level looping configuration
# When enabled: true, pipeline automatically runs in loop mode
looping:
  enabled: true
  maxIterations: 5                 # Safety limit (default: 100)
  # directories:                   # Uncomment to override session-scoped defaults
  #   pending: custom/pending      # Agents write new pipeline YAMLs here
  #   running: custom/running      # Currently executing pipeline
  #   finished: custom/finished    # Successfully completed pipelines
  #   failed: custom/failed        # Failed pipeline files

notifications:
  enabled: true
  events:
    - pipeline.completed
    - pipeline.failed
  channels:
    local:
      enabled: true
      sound: true

agents:
  - name: story-writer
    agent: .agent-pipeline/agents/story_writer.md
    timeout: 300
