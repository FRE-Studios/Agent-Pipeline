name: post-commit-example
trigger: post-commit

# Settings for pipeline execution
settings:
  autoCommit: true
  commitPrefix: "[pipeline:{{stage}}]"
  failureStrategy: continue
  preserveWorkingTree: false
  executionMode: parallel

  # Context reduction for multi-stage pipelines
  contextReduction:
    enabled: true
    maxTokens: 50000              # Token limit for context
    strategy: summary-based       # summary-based or agent-based
    contextWindow: 3              # Number of recent stages to include in full
    requireSummary: true          # Require summary field from agents
    saveVerboseOutputs: true      # Save full outputs to .agent-pipeline/outputs/
    compressFileList: true        # Compress changed files list

# Git workflow configuration (optional)
# git:
#   baseBranch: main
#   branchStrategy: reusable
#   pullRequest:
#     autoCreate: true
#     title: "ðŸ¤– Automated Code Review - {{pipelineName}}"
#     reviewers: []
#     labels:
#       - automated
#       - code-review

# Notification configuration (optional)
# notifications:
#   enabled: true
#   events:
#     - pipeline.completed
#     - pipeline.failed
#   channels:
#     local:
#       enabled: true
#       sound: true

# Agent stages
agents:
  # Sequential execution: code-review â†’ quality-check â†’ doc-updater
  # Each stage builds on the previous stage's results
  - name: code-review
    agent: .claude/agents/code-reviewer.md
    timeout: 120
    outputs:
      - issues_found
      - severity_level

  - name: quality-check
    agent: .claude/agents/quality-checker.md
    dependsOn:
      - code-review
    timeout: 120
    onFail: warn

  - name: doc-updater
    agent: .claude/agents/doc-updater.md
    dependsOn:
      - quality-check
    timeout: 180
