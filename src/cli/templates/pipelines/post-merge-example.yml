name: post-merge-example
trigger: post-merge

# Git workflow configuration for post-merge cleanup
git:
  baseBranch: main
  branchStrategy: reusable
  branchPrefix: pipeline
  pullRequest:
    autoCreate: true
    title: "ðŸ§¹ Post-Merge Cleanup - {{pipelineName}}"
    labels:
      - automated
      - cleanup
      - post-merge

# Notification configuration
notifications:
  enabled: true
  events:
    - pipeline.completed
    - pipeline.failed
  channels:
    local:
      enabled: true
      sound: true
      openUrl: true

settings:
  autoCommit: true
  commitPrefix: "[cleanup:{{stage}}]"
  failureStrategy: continue  # Continue even if some cleanup fails
  preserveWorkingTree: false
  executionMode: parallel

# Agent stages
agents:
  # Run cleanup tasks in parallel after merge
  - name: doc-sync
    agent: .claude/agents/doc-updater.md
    timeout: 180
    outputs:
      - files_updated
      - sections_added

  - name: dependency-audit
    agent: .claude/agents/dependency-auditor.md
    timeout: 120
    outputs:
      - outdated_count
      - security_issues

  - name: code-consolidation
    agent: .claude/agents/code-reducer.md
    timeout: 180
    outputs:
      - duplicates_found
      - files_merged

  # Generate summary report after all cleanup completes
  - name: summary-report
    agent: .claude/agents/cleanup-reporter.md
    dependsOn:
      - doc-sync
      - dependency-audit
      - code-consolidation
    commitMessage: "Add post-merge cleanup summary"
